// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  password      String   // hash
  wallet_address String? // 32 bytes (solana pubkey), nullable
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  // Relations
  proposals     Proposal[]
  votes         Vote[]

  @@map("users")
}

model Proposal {
  id          Int      @id @default(autoincrement())
  author_id   Int
  payer       String   // 64 bytes (Solana keypair)
  description String   // expected to be markdown
  choices     String   // JSON array of the choices
  hash        String   // hash of the description + JSON of choices
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  // Relations
  author      User     @relation(fields: [author_id], references: [id], onDelete: Cascade)
  votes       Vote[]

  @@map("proposals")
}

model Vote {
  user_id        Int
  proposal_id    Int
  signature_hash String // 32 bytes (sha256)
  created_at     DateTime @default(now())

  // Relations
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  proposal       Proposal @relation(fields: [proposal_id], references: [id], onDelete: Cascade)

  @@id([user_id, proposal_id])
  @@map("votes")
}
